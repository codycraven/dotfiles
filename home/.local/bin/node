#!/usr/bin/env sh

NODE_VERSION="${NODE_VERSION:-14}"
DIR="$(pwd)"
ARGS="-i"

# If tty
if [ -t 0 ] ; then
	ARGS="${ARGS} -t"
fi

exec docker run $ARGS --rm \
	-u node:node \
	-v "$HOME/.gitconfig:/home/$USER/.gitconfig" \
	-v "$HOME/.ssh:/home/$USER/.ssh" \
	-v "$HOME/.npm:/home/$USER/.npm" \
	-u "$(id -u):$(id -g)" \
	--mount type=bind,source="$HOME"/.npmrc,target=/home/$USER/.npmrc \
	-v "$DIR:$DIR" \
	-v /etc/passwd:/etc/passwd:ro \
	-w "$DIR" \
	node:$NODE_VERSION $@
